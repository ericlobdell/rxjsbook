{"version":3,"sources":["spaceship/spaceship.js"],"names":[],"mappings":"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","file":"spaceship/spaceship.js","sourcesContent":["/// <reference path=\"../../Scripts/rx.all.js\" />\r\n\r\nvar canvas = document.createElement( \"canvas\" );\r\nvar ctx = canvas.getContext( \"2d\" );\r\ndocument.body.appendChild( canvas );\r\n\r\ncanvas.width = window.innerWidth;\r\ncanvas.height = window.innerHeight;\r\n\r\nconst SPEED = 40;\r\nconst STAR_COUNT = 250;\r\n\r\nvar StarStream = Rx.Observable.range( 1, STAR_COUNT )\r\n    .map(() => {\r\n        return {\r\n            x: +( Math.random() * canvas.width ),\r\n            y: +( Math.random() * canvas.height ),\r\n            size: Math.random() * 3 + 1\r\n        }\r\n    } )\r\n    .toArray()\r\n    .flatMap( stars => {\r\n        return Rx.Observable.interval( SPEED )\r\n            .map(() => {\r\n                stars.forEach( s => {\r\n                    if ( s.y >= canvas.height )\r\n                        s.y = 0;\r\n\r\n                    s.y += 3;\r\n                } );\r\n\r\n                return stars;\r\n            } );\r\n    } );\r\n\r\nconst HERO_Y = canvas.height - 30;\r\nvar mouseMove = Rx.Observable.fromEvent( canvas, \"mousemove\" );\r\nvar SpaceShip = mouseMove\r\n    .map( e => {\r\n        return {\r\n            x: e.clientX,\r\n            y: HERO_Y\r\n        };\r\n    } )\r\n    .startWith( {\r\n        x: canvas.width / 2,\r\n        y: HERO_Y\r\n    } );\r\n\r\nconst ENEMY_FREQ = 1500;\r\nvar Enemies = Rx.Observable.interval( ENEMY_FREQ )\r\n    .scan( enemies => {\r\n        enemies.push( {\r\n            x: +( Math.random() * canvas.width ),\r\n            y: -30\r\n        } );\r\n\r\n        return enemies;\r\n    }, [] );\r\n\r\nvar playerFiring = Rx.Observable\r\n    .merge(\r\n        Rx.Observable.fromEvent( canvas, \"click\" ),\r\n        Rx.Observable.fromEvent( canvas, \"keydown\" )\r\n            .filter( e => e.keycode === 32 )\r\n    )\r\n    .sample( 200 )\r\n    .timestamp();\r\n\r\nvar HeroShots = Rx.Observable\r\n    .combineLatest(\r\n    playerFiring,\r\n    SpaceShip,\r\n    ( shots, spaceShip ) => {\r\n        return {\r\n            x: spaceShip.x,\r\n            timestamp: shots.timestamp\r\n        }\r\n    }\r\n    )\r\n    .distinctUntilChanged( shot => shot.timestamp )\r\n    .scan(( shots, shot ) => {\r\n        shots.push( {\r\n            x: shot.x,\r\n            y: HERO_Y\r\n        } );\r\n\r\n        return shots;\r\n    }, [] );\r\n\r\nvar SHOOTING_SPEED = 15;\r\n\r\nfunction paintHeroShots( shots ) {\r\n    shots.forEach( shot => {\r\n        console.log( \"Shot Fired!\", shot );\r\n        shot.y -= SHOOTING_SPEED;\r\n\r\n        drawTriangle( shot.x, shot.y, 5, \"#ffff00\", \"up\" );\r\n    } );\r\n}\r\n\r\nvar Game = Rx.Observable\r\n    .combineLatest( StarStream, SpaceShip, Enemies, HeroShots,\r\n        ( stars, spaceship, enemies, heroShots ) => {\r\n            return {\r\n                stars: stars,\r\n                spaceship: spaceship,\r\n                enemies: enemies,\r\n                shots: heroShots\r\n            };\r\n        } )\r\n    .sample( SPEED )\r\n    .subscribe( renderScene );\r\n\r\nfunction isVisible( obj ) {\r\n    return obj.x > -40 && obj.x < canvas.width + 40 &&\r\n            obj.y > -40 && obj.y < canvas.height + 40;\r\n}\r\n\r\nfunction getRandomInt( min, max ) {\r\n    return Math.floor( Math.random() * ( max - min + 1 ) ) + min;\r\n}\r\n\r\nfunction paintEnemies( enemies ) {\r\n    enemies.forEach( e => {\r\n        e.y += 5;\r\n        e.x += getRandomInt( -15, 15 );\r\n        drawTriangle( e.x, e.y, 20, \"#00ff00\", \"down\" );\r\n    } );\r\n}\r\n\r\nfunction drawTriangle( x, y, width, color, direction ) {\r\n    ctx.fillStyle = color;\r\n    ctx.beginPath();\r\n    ctx.moveTo( x - width, y );\r\n    ctx.lineTo( x, direction === 'up' ? y - width : y + width );\r\n    ctx.lineTo( x + width, y );\r\n    ctx.lineTo( x - width, y );\r\n    ctx.fill();\r\n}\r\n\r\nfunction paintSpaceship( x, y ) {\r\n    drawTriangle( x, y, 20, \"#ff0000\", 'up' );\r\n}\r\n\r\nfunction paintStars( stars ) {\r\n    ctx.fillStyle = \"#000000\";\r\n    ctx.fillRect( 0, 0, canvas.width, canvas.height );\r\n\r\n    ctx.fillStyle = \"#ffffff\";\r\n    stars.forEach( s => ctx.fillRect( s.x, s.y, s.size, s.size ) );\r\n}\r\n\r\nfunction renderScene( actors ) {\r\n    paintStars( actors.stars );\r\n    paintSpaceship( actors.spaceship.x, actors.spaceship.y );\r\n    paintEnemies( actors.enemies );\r\n    paintHeroShots( actors.shots );\r\n}\r\n\r\n\r\n\r\n\r\n"],"sourceRoot":"/source/"}